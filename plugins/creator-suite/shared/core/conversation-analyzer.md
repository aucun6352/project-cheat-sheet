# Conversation Analyzer - 대화 기반 자동 정보 추출

Phase 0에서 사용되는 대화 히스토리 분석 엔진입니다. 현재 세션의 대화 내용을 분석하여 생성에 필요한 정보를 자동으로 추출합니다.

## 목적

사용자가 이미 대화를 통해 표현한 요구사항, 워크플로우, 패턴을 자동으로 파악하여:
- 수동 입력 부담 감소
- 일관성 있는 문서 생성
- 대화 컨텍스트 활용

## 실행 조건

### 자동 실행 조건
다음 조건 중 하나라도 만족하면 Conversation Analyzer가 자동 실행됩니다:

1. **대화 히스토리 존재**:
   - 현재 세션에 최소 3개 이상의 메시지 교환
   - 최근 10개 메시지 내에 관련 키워드 포함

2. **워크플로우 패턴 감지**:
   - "항상 ~하고 있어", "매번 ~해", "보통 ~하는 편이야"
   - "다음 순서로", "먼저 ~, 그 다음 ~"
   - "~할 때마다", "~하면서"

3. **문제 해결 대화**:
   - 반복적인 작업이나 문제에 대한 논의
   - 특정 도구나 패턴에 대한 질문

### 수동 실행
사용자가 명시적으로 요청:
- "방금 얘기한 걸로 에이전트 만들어줘"
- "이 워크플로우를 커맨드로 만들자"
- "대화 내용을 바탕으로 스킬 생성해줘"

---

## 분석 프로세스

### 1. 대화 히스토리 수집

**수집 범위**:
```
최근 대화 → 최대 50개 메시지
관련성 필터링 → 생성 컨텍스트와 관련된 메시지만 추출
노이즈 제거 → 인사말, 확인 메시지 등 제외
```

**수집 대상**:
- 사용자 메시지: 요구사항, 설명, 예시
- 어시스턴트 응답: 제안, 구현, 설명
- 코드 스니펫: 실제 사용 패턴
- 파일 경로: 관련 파일 및 디렉토리

---

### 2. 패턴 추출

#### 워크플로우 패턴
대화에서 순차적 작업 흐름을 식별합니다.

**감지 키워드**:
- 순서: "먼저", "그 다음", "마지막으로", "이후에"
- 조건: "만약", "~라면", "~할 때", "~인 경우"
- 반복: "항상", "매번", "보통", "일반적으로"

**예시**:
```
사용자: "코드 리뷰할 때 항상 먼저 타입 체크하고,
        그 다음 테스트 실행하고, 마지막으로 린트 검사해"

추출된 워크플로우:
1. 타입 체크 실행
2. 테스트 실행
3. 린트 검사
```

#### 도구 사용 패턴
대화에서 언급된 도구와 사용 방법을 추출합니다.

**감지 대상**:
- Claude Code 도구: Read, Write, Edit, Bash, Grep 등
- MCP 서버: Serena, Sequential, Magic 등
- 외부 도구: npm, git, docker 등

**예시**:
```
사용자: "파일을 먼저 Read로 읽고,
        Sequential로 분석한 다음,
        Edit로 수정하는 게 좋을 것 같아"

추출된 도구 패턴:
- Primary: Read, Sequential, Edit
- Sequence: Read → Sequential → Edit
```

#### 비즈니스 로직 패턴
도메인 특화 규칙과 제약사항을 추출합니다.

**감지 대상**:
- 검증 규칙: "~해야 한다", "~가 필수", "~는 안 됨"
- 정책: "~일 때만", "~를 제외하고", "~우선"
- 계산: "~를 더해서", "~로 나눠서", "~보다 크면"

**예시**:
```
사용자: "주문 금액이 10만원 이상이면 무료배송이고,
        쿠폰은 최대 3개까지 중복 적용 가능해"

추출된 비즈니스 로직:
- 무료배송 조건: 주문금액 >= 100,000
- 쿠폰 제약: 최대 3개 중복 적용
```

---

### 3. 메타데이터 생성

추출된 패턴을 바탕으로 생성에 필요한 메타데이터를 자동 생성합니다.

#### Name 생성

**생성 규칙**:
```
1. 핵심 키워드 추출 (명사, 동사)
2. kebab-case 변환
3. 중복 확인 및 고유성 보장
```

**예시**:
```
입력: "코드 리뷰할 때 타입 체크하고 테스트 실행"
추출 키워드: code, review, type, check, test
생성 Name: code-review-type-checker
```

#### Description 생성

**생성 규칙**:
```
1. 핵심 동작을 한 문장으로 요약
2. "~하는", "~를 위한", "~전문" 형식
3. 30-100자 길이 유지
```

**예시**:
```
입력: "코드 리뷰 시 타입 안정성을 검증하고 테스트 커버리지를 확인하는 워크플로우"
생성 Description: "코드 리뷰 시 타입 검증과 테스트 실행을 자동화하는 워크플로우"
```

#### Type 추론

각 생성 대상별로 적절한 타입을 추론합니다.

**Agent Type 추론**:
```
워크플로우 복잡도 분석:
- 단계 수: 1-2개 → Specialist
- 단계 수: 3-5개 → Analyst
- 단계 수: 6개 이상 → Orchestrator

도구 사용 개수:
- 1-2개 도구 → Specialist
- 3-5개 도구 → Analyst
- 6개 이상 → Orchestrator
```

**Command Type 추론**:
```
워크플로우 분석:
- 단일 작업 → Simple Task Command
- 순차 실행 → Workflow Pipeline Command
- 복잡한 조건/반복 → Complex Orchestration Command

단어 수 기준:
- 50-150 단어 → Simple Task
- 150-400 단어 → Workflow Pipeline
- 400+ 단어 → Complex Orchestration
```

**Skill Type 추론**:
```
내용 분석:
- 간단한 팁/트릭 → Quick Workflow
- 단계별 가이드 → Comprehensive Guide
- 심층 분석 → Deep Dive
- 패턴 컬렉션 → Pattern Library

단어 수 기준:
- 50-200 단어 → Quick Workflow
- 200-600 단어 → Comprehensive Guide
- 600-1500 단어 → Deep Dive
- 1500+ 단어 → Pattern Library
```

---

### 4. 추천 모드 vs 직접 입력 모드

분석 결과를 사용자에게 제시하고 선택하게 합니다.

#### 추천 모드 (Recommended)

**조건**:
- 대화 분석 신뢰도 > 70%
- 필수 정보 모두 추출 성공
- 타입 추론 확실성 > 80%

**사용자 경험**:
```
🤖 대화 분석 완료! 다음 정보를 자동으로 추출했습니다:

📋 추출 정보:
- Name: code-review-type-checker
- Description: 코드 리뷰 시 타입 검증과 테스트 실행을 자동화
- Type: Analyst

✨ 자동 추출된 워크플로우:
1. TypeScript 타입 체크 (tsc --noEmit)
2. 단위 테스트 실행 (npm test)
3. 린트 검사 (eslint)

이 정보로 계속 진행하시겠습니까?
[1] 예, 이대로 진행
[2] 수정하고 싶어요
[3] 처음부터 직접 입력
```

#### 직접 입력 모드

**조건**:
- 대화 분석 신뢰도 < 70%
- 필수 정보 일부 누락
- 사용자가 직접 입력 선택

**사용자 경험**:
```
💭 대화 분석 결과 일부 정보를 추출할 수 없습니다.

추출된 정보:
- ✅ 워크플로우 패턴 감지됨
- ⚠️ Name 생성 불확실
- ❌ Type 추론 실패

직접 입력 모드로 전환합니다.
Phase 1부터 순차적으로 정보를 입력해주세요.
```

---

## 신뢰도 계산

### 신뢰도 점수 체계

각 항목별로 0-100점 사이의 신뢰도를 계산합니다.

**Name 신뢰도**:
```
키워드 명확성: 40점
- 명사/동사 명확히 식별: 40점
- 모호함: 20점
- 식별 불가: 0점

중복 여부: 30점
- 고유성 보장: 30점
- 약간 중복: 15점
- 심각한 중복: 0점

길이 적절성: 30점
- 2-5 단어: 30점
- 1 또는 6+ 단어: 15점
```

**Description 신뢰도**:
```
요약 품질: 50점
- 핵심 동작 명확: 50점
- 부분적 명확: 25점
- 불명확: 0점

길이 적절성: 30점
- 30-100자: 30점
- 범위 벗어남: 15점

문법 정확성: 20점
- 완전한 문장: 20점
- 불완전: 10점
```

**Type 신뢰도**:
```
패턴 일치도: 60점
- 명확한 패턴 일치: 60점
- 부분 일치: 30점
- 불일치: 0점

복잡도 분석 정확성: 40점
- 정확한 복잡도 추정: 40점
- 추정 불확실: 20점
```

**종합 신뢰도**:
```
종합 = (Name * 0.3) + (Description * 0.3) + (Type * 0.4)

> 70점: 추천 모드 활성화
50-70점: 추천 제시, 수정 권장
< 50점: 직접 입력 모드 권장
```

---

## 실전 예제

### 예제 1: Agent 생성 - 높은 신뢰도

**대화**:
```
User: "API 테스트할 때 항상 먼저 인증 토큰 받고,
       엔드포인트 호출하고, 응답 검증해야 해서 번거로워"