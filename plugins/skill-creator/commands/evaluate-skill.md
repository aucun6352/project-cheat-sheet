# 스킬 평가 커맨드 (Evaluate Skill)

이 커맨드는 기존 SKILL.md 파일을 검증하고 개선 제안을 제공합니다.

## 목적

기존 SKILL.md의 품질을 객관적으로 평가하고, 자동 수정 가능한 항목은 즉시 개선하여 일관된 품질 기준을 유지합니다.

## Extended Thinking

당신은 스킬 평가 전문가로서 다음과 같이 동작합니다:

**📋 진행 상황 체크리스트**:
- [ ] Phase 1: SKILL.md 평가 (파일 읽기 → 검증 실행 → 리포트 생성)
- [ ] Phase 2: 개선 적용 (조건부 - 사용자가 자동 수정 선택 시)

**🔄 진행 방식**:
각 Phase를 시작할 때마다 다음과 같이 진행 상황을 안내합니다:
```
✅ Phase X 완료 → 🔄 Phase Y 시작: [Phase 설명]

📊 진행 상황: X/2 Phase 완료
```

**핵심 동작**:
1. **SKILL.md 검증**: @skill-creator/shared/validation-criteria.md 기준으로 6가지 검증 실행
2. **점수 자동 계산**: 각 검증 항목별 점수 합산 → A/B/C/D/F 등급 부여
3. **Executive Summary 생성**: 3줄로 핵심 정보 요약
4. **자동 수정 제안**: 간단히 수정 가능한 항목 자동 적용 옵션 제공

## 실행 단계

### Phase 1: SKILL.md 평가

**1. 평가 대상 선택**

AskUserQuestion으로 평가할 SKILL.md 파일 경로 입력 요청:
```
💡 예시:
- java-design-principles/SKILL.md
- ./my-skill/SKILL.md
- ../other-project/skill-name/SKILL.md
```

**파일 존재 여부 확인:**
- Read 도구로 파일 읽기 시도
- 실패 시 에러 처리 (아래 "에러 처리" 섹션 참조)

---

**2. SKILL.md 분석**

```
📊 평가 시작

🔍 대상: {파일_경로}
📄 파일 읽기 중...
```

**기본 정보 추출:**
1. Frontmatter 파싱 (YAML)
2. 단어 수 계산 (validation-criteria.md 기준)
3. H1/H2/H3 개수 세기
4. 코드 블록 개수 세기

---

**3. 6가지 검증 실행**

**⚠️ 중요:** @skill-creator/shared/validation-criteria.md 의 검증 기준을 정확히 따릅니다.

각 검증 항목마다:
1. 조건 확인
2. 점수 계산 (validation-criteria.md 기준)
3. 통과/실패 판정
4. 개선 제안 생성

**검증 항목:**
- ✅ 검증 1: 구조 검증 (20점)
- ✅ 검증 2: Frontmatter 검증 (15점)
- ✅ 검증 3: 필수 섹션 검증 (20점)
- ✅ 검증 4: 콘텐츠 품질 검증 (25점)
- ✅ 검증 5: 스킬 타입 적합성 (10점)
- ✅ 검증 6: 일관성 및 완성도 (10점)

---

**4. 점수 계산 및 등급 부여**

```
총점 = 검증1 + 검증2 + 검증3 + 검증4 + 검증5 + 검증6

등급 기준 (validation-criteria.md):
- A (90-100): 우수
- B (80-89): 양호
- C (70-79): 보통
- D (60-69): 부족
- F (< 60): 불합격
```

---

**5. 평가 리포트 생성**

**리포트 구조:**

```markdown
📊 SKILL.md 평가 결과 리포트

## 📌 Executive Summary

**등급: {등급} ({점수}/100)**
**핵심 문제: {가장_중요한_문제_1-2개}**
**추천 조치: {즉시_실행_가능한_조치}**

---

## 점수 상세

| 검증 항목 | 점수 | 만점 | 비고 |
|-----------|------|------|------|
| 1. 구조 검증 | {점수} | 20 | {상태} |
| 2. Frontmatter 검증 | {점수} | 15 | {상태} |
| 3. 필수 섹션 검증 | {점수} | 20 | {상태} |
| 4. 콘텐츠 품질 검증 | {점수} | 25 | {상태} |
| 5. 스킬 타입 적합성 | {점수} | 10 | {상태} |
| 6. 일관성 및 완성도 | {점수} | 10 | {상태} |
| **총점** | **{총점}** | **100** | **{등급}** |

---

## ✅ 잘된 점 ({통과_항목}개)

- {항목 1}
- {항목 2}
- ...

---

## ⚠️ 개선 필요 ({개선_항목}개)

### 우선순위 HIGH (즉시 수정 권장)
1. **{문제_영역}**: {구체적_문제}
   - 📍 위치: {파일:라인} 또는 {섹션명}
   - 💡 개선 방향: {구체적_제안}
   - 🔧 자동 수정: {가능/불가능}

### 우선순위 MEDIUM (개선 권장)
...

### 우선순위 LOW (선택 사항)
...

---

## 💡 개선 제안

### 구조 개선
{Progressive Disclosure 권장사항}
{파일 분리 제안}

### 콘텐츠 개선
{누락된 섹션 추가}
{예제 품질 향상}
{시각적 마커 추가}

### 스타일 개선
{용어 일관성}
{코드 블록 언어 명시}

---

## 📋 상세 검증 결과

### 1. 구조 검증 ({{점수}}/20)
- SKILL.md 존재: {✅/❌}
- 단어 수: {숫자}개
- 현재 Level: {레벨}
- 권장 Level: {레벨}
- 파일 구조: {현재_구조}
- **개선 제안**: {제안}

### 2. Frontmatter 검증 ({점수}/15)
- name: {✅/❌} ({실제값})
- description: {✅/❌} ({글자수}/1024)
- license: {✅/❌/없음}
- **개선 제안**: {제안}

### 3. 필수 섹션 검증 ({점수}/20)
- H1 제목: {✅/❌} ({개수}개 발견)
- When to Use: {✅/❌}
- Core Concepts: {✅/❌}
- Best Practices: {✅/❌}
- **개선 제안**: {제안}

### 4. 콘텐츠 품질 ({점수}/25)
- 코드 블록 언어 명시: {명시율}% ({명시개수}/{전체개수})
  - 미지정 위치: {라인 번호들}
- 섹션 계층: {✅/❌}
- 링크 형식: {✅/❌}
- 용어 일관성: {✅/❌}
- **개선 제안**: {제안}

### 5. 스킬 타입 ({점수}/10)
- 추정 타입: {타입}
- 단어 수 적합성: {✅/❌}
- 권장 섹션 포함: {포함개수}/{전체개수}
- **개선 제안**: {제안}

### 6. 일관성 및 완성도 ({점수}/10)
- 오타: {개수}개 발견
- 완성도: {✅/⚠️/❌}
- **개선 제안**: {제안}

---

## 🎯 다음 단계

### 옵션 1: 직접 수정 (권장)
이 리포트를 참고하여 SKILL.md를 직접 편집하세요.

### 옵션 2: 자동 수정 적용 (Phase 2)
다음 항목들을 자동으로 수정할 수 있습니다:
{자동_수정_가능_항목_목록}

**예상 개선 후 점수:** {개선_후_점수}점 ({개선_후_등급})

### 옵션 3: 평가만 하고 종료
리포트를 저장하고 나중에 수정합니다.
```

---

**6. 사용자에게 다음 단계 선택 요청**

AskUserQuestion으로 선택지 제공:

```
다음 단계를 선택하세요:

1. 직접 수정 (리포트 참고)
2. 자동 수정 적용 (Phase 2 진행)
3. 평가만 하고 종료
```

**선택에 따라 분기:**
- 직접 수정 또는 종료: 평가 종료
- 자동 수정: Phase 2로 이동

---

### Phase 2: 개선 적용 (조건부 - "자동 수정" 선택 시만 실행)

**⚠️ 중요:** 이 Phase는 사용자가 "자동 수정 적용"을 선택한 경우에만 실행됩니다.

**목적:** Phase 1 평가 결과를 바탕으로 간단한 수정 사항을 자동으로 적용합니다.

---

**1. 자동 수정 가능 항목 확인**

**✅ 자동 수정 가능:**
- 코드 블록 언어 명시 누락
- Frontmatter name 형식 오류 (kebab-case 변환)
- Frontmatter description 길이 초과 (1024자 트리밍)
- H1 제목 중복 (첫 번째만 유지, 나머지 H2로)
- 섹션 계층 오류 (H1 바로 다음 H3 → H2로)

**⚠️ 수동 수정 권장:**
- 누락된 섹션 추가 (콘텐츠 작성 필요)
- Progressive Disclosure 구조 변경 (파일 분리 필요)
- 콘텐츠 품질 개선 (사람의 판단 필요)
- 용어 일관성 (컨텍스트 이해 필요)

---

**2. 자동 수정 항목 선택**

사용자에게 수정할 항목 확인:

```
📝 자동 수정 항목

다음 항목들을 자동으로 수정할 수 있습니다:

1. ✅ 코드 블록 언어 명시 ({개수}개 위치)
2. ✅ Frontmatter name 형식 수정
3. ✅ H1 제목 중복 제거 ({개수}개 → 1개)
4. ⚠️ 섹션 계층 조정

예상 점수 향상: +{점수}점 ({현재점수} → {예상점수})

수정하시겠습니까?
- "모두 적용"
- "선택적 적용" (개별 선택)
- "취소"
```

---

**3. 수정 사항 적용**

**3-1. 코드 블록 언어 명시**

**방법:**
1. 정규표현식으로 ` ```\n` 패턴 찾기
2. 주변 컨텍스트 분석하여 언어 추정:
   ```
   function/const/let/var → javascript
   class/public/private/static (Java 스타일) → java
   def/import/class (Python 스타일) → python
   #!/bin/bash → bash
   SELECT/INSERT/UPDATE → sql
   <tag> → html
   { "key": → json
   ```
3. 추정 불가 → 사용자에게 언어 질문
4. Edit 도구로 ` ```언어\n` 으로 수정

**주의:** 잘못 추정할 수 있으므로 신뢰도가 낮으면 사용자에게 확인!

---

**3-2. Frontmatter name 형식 수정**

**방법:**
1. 현재 name 읽기
2. kebab-case 변환:
   - 모든 공백 → 하이픈 (-)
   - 모든 대문자 → 소문자
   - 특수문자 제거 (하이픈과 숫자 제외)
   - 연속된 하이픈 → 단일 하이픈
   - 시작/끝 하이픈 제거
3. Edit 도구로 Frontmatter 수정

**예시:**
```
"Java Design Principles" → "java-design-principles"
"API_Reference V2" → "api-reference-v2"
"Quick--Start  Guide" → "quick-start-guide"
```

---

**3-3. H1 제목 중복 제거**

**방법:**
1. 정규표현식으로 `^# ` 패턴 모두 찾기
2. 첫 번째 H1만 유지
3. 나머지는 `## `로 변경
4. Edit 도구로 수정

---

**3-4. 섹션 계층 조정**

**방법:**
1. H1 다음에 바로 H3가 오는 경우 찾기
2. 해당 H3를 H2로 변경
3. Edit 도구로 수정

---

**4. 수정 결과 리포트**

```markdown
✅ 자동 수정 완료!

## 적용된 수정 사항

### 코드 블록 언어 명시 ({개수}개)
- Line 125: ` ``` ` → ` ```java `
- Line 234: ` ``` ` → ` ```python `
- Line 456: ` ``` ` → ` ```bash `

### Frontmatter 수정
- name: "{이전값}" → "{새값}"

### H1 제목 중복 제거
- Line 50: `# Overview` → `## Overview`
- Line 123: `# Examples` → `## Examples`

### 섹션 계층 조정
- Line 78: `### Core Concepts` → `## Core Concepts`

---

## 재평가 결과

**이전 점수:** {이전점수}/100 ({이전등급})
**현재 점수:** {현재점수}/100 ({현재등급})
**향상:** +{점수차이}점

### 개선된 항목
- ✅ 코드 블록 언어 명시: {이전}% → {현재}%
- ✅ Frontmatter 형식: ❌ → ✅
- ✅ H1 제목: {이전}개 → 1개
- ✅ 섹션 계층: ❌ → ✅

### 남은 개선 사항
{아직_개선되지_않은_항목들}
```

---

**5. 사용자 안내**

```
✅ 자동 수정이 완료되었습니다!

📂 수정된 파일: {파일_경로}

📖 다음 단계:
1. 수정 내용 확인 (git diff 또는 파일 직접 열기)
2. 남은 개선 사항은 직접 수정 (위 리포트 참고)
3. 필요시 추가 평가 실행 (/evaluate-skill)

💡 팁:
- git diff로 변경 사항을 먼저 확인하세요
- 만족스럽지 않다면 git checkout으로 되돌릴 수 있습니다
- Progressive Disclosure나 섹션 추가는 수동으로 작업하세요
```

---

**6. 선택 사항: 추가 평가**

사용자에게 AskUserQuestion으로 선택지 제공:
- "재평가 실행" → Phase 1로 돌아가서 다시 평가
- "완료" → 종료

---

## 에러 처리

### 파일이 존재하지 않음
```
❌ 파일을 찾을 수 없습니다.

경로: {입력된_경로}
현재 디렉토리: {현재_디렉토리}

💡 도움말:
- 상대 경로 예시: ./skill-name/SKILL.md
- 절대 경로 예시: /Users/.../skill-name/SKILL.md
- 현재 위치에서 탐색: ls 명령으로 확인

다시 경로를 입력해주세요.
```

### SKILL.md가 아닌 파일
```
⚠️ 이 파일은 SKILL.md가 아닙니다.

파일명: {실제_파일명}

SKILL.md 파일을 선택해주세요.
```

### 잘못된 Frontmatter 형식
```
❌ Frontmatter를 읽을 수 없습니다.

오류: {파싱_오류_메시지}

💡 올바른 형식:
---
name: skill-name
description: Skill description here
---

YAML 형식을 확인하고 수동으로 수정한 후 다시 평가하세요.
```

### 빈 파일 또는 너무 짧은 파일
```
⚠️ 파일이 너무 짧습니다.

크기: {바이트_수} bytes (최소 100자 필요)

내용을 추가한 후 다시 평가하세요.
```

### 자동 수정 실패
```
❌ 자동 수정 중 오류가 발생했습니다.

항목: {실패한_수정_항목}
오류: {오류_메시지}

💡 복구 방법:
1. git checkout {파일_경로} (Git 사용 시)
2. 백업에서 복원
3. 수동으로 수정

다음 수정 항목을 계속할까요?
```

---

## 주의사항

1. **검증 기준 준수**:
   - 반드시 @skill-creator/shared/validation-criteria.md 의 기준을 따르세요
   - 점수 계산은 정확히 validation-criteria.md의 공식대로 계산하세요
   - 자의적인 해석이나 추가 감점/가점을 하지 마세요

2. **Executive Summary 작성**:
   - 3줄 이내로 핵심만 요약
   - 등급, 핵심 문제, 추천 조치를 명확히
   - 사용자가 리포트 전체를 읽지 않아도 핵심을 파악할 수 있게

3. **자동 수정 신중하게**:
   - 언어 추정 신뢰도가 낮으면 사용자에게 질문
   - 수정 전 항상 개수와 위치를 사용자에게 알림
   - 수정 후 반드시 재평가하여 점수 변화 확인

4. **Read 도구 사용**:
   - SKILL.md 파일 읽기 시 Read 도구 사용
   - 파일이 크면 offset/limit 파라미터 활용

5. **Edit 도구 사용**:
   - 자동 수정 시 Edit 도구 사용
   - old_string과 new_string을 정확히 매칭
   - 수정 실패 시 에러 처리

6. **AskUserQuestion 사용**:
   - 모든 사용자 선택은 AskUserQuestion 도구로
   - 명확한 옵션 제공 (모호하지 않게)

7. **진행 상황 안내**:
   - 각 Phase 시작 시: "✅ Phase X 완료 → 🔄 Phase Y 시작"
   - 전체 진행률 표시: "📊 진행 상황: X/2 Phase 완료"

8. **리포트 품질**:
   - 상세하면서도 읽기 쉽게
   - 표와 목록을 적절히 활용
   - 이모지로 시각적 구분 (✅/❌/⚠️)

---

**이제 SKILL.md 평가를 시작합니다. 평가할 SKILL.md 파일의 경로를 입력해주세요.**
